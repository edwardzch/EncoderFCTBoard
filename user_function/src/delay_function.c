/****************************************************************************************
  * @file      delay_function.c
  * @brief     微秒、毫秒、秒级延时函数实现
  * ****************************************************************************************/
#include "delay_function.h"

/**************************************************************************************
* 函数名称：delay_us()
* 函数功能：实现微秒级高精度延时
* 输入参量：us - 延时微秒数
* 输出参量：无
* 编写日期：2025-06-26
***************************************************************************************/
void delay_us(uint32_t us)
{
    uint32_t start = SysTick->VAL;
    uint32_t ticks = us * (SystemCoreClock / 1000000);  // 将微秒转换为时钟节拍数
    uint32_t reload = SysTick->LOAD + 1;
    uint32_t elapsed = 0;
    uint32_t current;

    while (elapsed < ticks)
    {
        current = SysTick->VAL;
        // SysTick 是向下计数的递减计数器
        if (current <= start)
            elapsed += start - current;
        else
            elapsed += start + (reload - current);      // 处理计数器重装载/溢出情况
        start = current;
    }
}

/**************************************************************************************
* 函数名称：delay_ms()
* 函数功能：实现毫秒级延时
* 输入参量：ms - 延时毫秒数
* 输出参量：无
* 编写日期：2026-02-04
***************************************************************************************/
void delay_ms(uint32_t ms)
{
    while (ms--)
    {
        delay_us(1000); // 循环调用 1000 微秒实现 1 毫秒
    }
}

/**************************************************************************************
* 函数名称：delay_s()
* 函数功能：实现秒级延时
* 输入参量：s - 延时秒数
* 输出参量：无
* 编写日期：2026-02-04
***************************************************************************************/
void delay_s(uint32_t s)
{
    while (s--)
    {
        delay_ms(1000); // 循环调用 1000 毫秒实现 1 秒
    }
}
